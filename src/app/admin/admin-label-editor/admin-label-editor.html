<div class="label-editor-container">
  <h1>Assign Labels</h1>
  <div class="image-wrapper" (click)="placeMarker($event)" #imageWrapper>
    <img *ngIf="imageUrl" [src]="imageUrl" [alt]="topic?.name" class="main-image">
    <div class="image-placeholder" *ngIf="!imageUrl">
      Image: {{ topic?.name || 'No Image Available' }}
    </div>
    <div *ngFor="let l of labels; let i = index" class="label-dot" [style.left.px]="l.x" [style.top.px]="l.y"
      [style.width.px]="l.width" [style.height.px]="l.height" (mousedown)="startDrag($event, i)">
      <div class="dot"></div>
    </div>
  </div>

  <h2>Label Details</h2>
  <div class="label-card" *ngFor="let l of labels; let i = index">
    <div class="label-card-header">
      <h3>Label {{ i + 1 }}</h3>
      <button *ngIf="l.id" class="delete-btn" (click)="deleteLabel(l, i)">Delete</button>
    </div>

    <label>English Translation</label>
    <input [(ngModel)]="l.translations.en" />

    <label>Persian Translation</label>
    <input [(ngModel)]="l.translations.fa" />

    <label>Arabic Translation</label>
    <input [(ngModel)]="l.translations.ar" />

    <label>Persian Audio</label>
    <input type="file" accept="audio/*" (change)="uploadAudio($event, i, 'fa')" />

    <button class="audio-record-btn" (click)="toggleRecording(i, 'fa')">
      üéôÔ∏è {{ isRecording(i,'fa') ? 'Stop Recording' : 'Record Persian' }}
    </button>

    <div *ngIf="hasRecordedAudio(i, 'fa')" style="margin-top: 8px;">
      <audio controls [src]="getAudioUrl(i, 'fa')" style="width: 100%; max-width: 300px;"></audio>
      <button class="delete-btn" (click)="deleteRecordedAudio(i, 'fa')" style="margin-left: 8px;">Delete
        Recording</button>
    </div>

    <label>Arabic Audio</label>
    <input type="file" accept="audio/*" (change)="uploadAudio($event, i, 'ar')" />

    <button class="audio-record-btn" (click)="toggleRecording(i, 'ar')">
      üéôÔ∏è {{ isRecording(i,'ar') ? 'Stop Recording' : 'Record Arabic' }}
    </button>

    <div *ngIf="hasRecordedAudio(i, 'ar')" style="margin-top: 8px;">
      <audio controls [src]="getAudioUrl(i, 'ar')" style="width: 100%; max-width: 300px;"></audio>
      <button class="delete-btn" (click)="deleteRecordedAudio(i, 'ar')" style="margin-left: 8px;">Delete
        Recording</button>
    </div>

    <label>X Coordinate</label>
    <input type="number" [(ngModel)]="l.x" />

    <label>Y Coordinate</label>
    <input type="number" [(ngModel)]="l.y" />

    <label>Width</label>
    <input type="number" [(ngModel)]="l.width" />

    <label>Height</label>
    <input type="number" [(ngModel)]="l.height" />
  </div>

  <button class="save-all" (click)="saveAllLabels()">Save All</button>
</div>